<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scriptoria</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        obsidian: '#050505',
                        gold: '#D4AF37',
                    },
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        inter: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="antialiased">

    <!-- Background Image Layer -->
    <div class="obsidian-bg"></div>

    <!-- Global Frosted Shell Layer -->
    <div class="obsidian-shell"></div>

    <!-- Vue App Mount -->
    <div id="app" class="relative z-10 flex items-center justify-center min-h-screen p-4">

        <!-- Glass Container -->
        <div
            class="glass-card w-full max-w-5xl min-h-[700px] flex flex-col relative overflow-hidden transition-all duration-500">

            <!-- Header -->
            <header class="p-8 text-center border-b border-white/5">
                <h1 class="text-3xl md:text-4xl text-white font-cinzel tracking-widest">
                    SCRIPTORIA
                </h1>
            </header>

            <!-- Main Content -->
            <main class="flex-1 flex flex-col relative">

                <transition name="fade" mode="out-in">

                    <!-- INIT State -->
                    <div v-if="appState === 'INIT'" key="init" class="flex-1 flex items-center justify-center">
                        <div class="text-center">
                            <div class="thinking-core mx-auto mb-6"></div>
                            <p class="text-secondary font-light tracking-widest text-sm">{{ systemMessage }}</p>
                        </div>
                    </div>

                    <!-- LOGIN State -->
                    <div v-else-if="appState === 'LOGIN'" key="login" class="flex-1 flex items-center justify-center">
                        <div class="w-full max-w-md mx-auto p-8">
                            <div class="text-center mb-8">
                                <h2 class="text-xl text-white font-cinzel mb-2">Identity Verification</h2>
                                <p class="text-secondary text-sm">Enter your credentials to access the Scriptorium.</p>
                            </div>

                            <form @submit.prevent="checkLogin" :class="{ 'animate-shake': isShake }" class="space-y-6">
                                <div>
                                    <input v-model="form.username" type="text" placeholder="Username"
                                        class="ghost-input" autofocus>
                                </div>
                                <div>
                                    <input v-model="form.password" type="password" placeholder="Password"
                                        class="ghost-input">
                                </div>

                                <div v-if="errorMsg" class="text-error text-xs text-center">{{ errorMsg }}</div>

                                <button type="submit"
                                    class="status-btn primary w-full flex justify-center items-center gap-2">
                                    <span>Enter</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- SETUP_KEY State -->
                    <div v-else-if="appState === 'SETUP_KEY'" key="setup_key"
                        class="flex-1 flex items-center justify-center">
                        <div class="w-full max-w-md mx-auto p-8">
                            <div class="text-center mb-8">
                                <h2 class="text-xl text-white font-cinzel mb-2">API Configuration</h2>
                                <p class="text-secondary text-sm">A Google Gemini API Key is required to power the Core.
                                </p>
                            </div>

                            <form @submit.prevent="saveKey" :class="{ 'animate-shake': isShake }" class="space-y-6">
                                <div>
                                    <input v-model="form.apiKey" type="password" placeholder="Paste Gemini API Key"
                                        class="ghost-input">
                                </div>

                                <div v-if="errorMsg" class="text-error text-xs text-center">{{ errorMsg }}</div>

                                <button type="submit" class="status-btn primary w-full">
                                    Verify & Save
                                </button>
                            </form>

                            <div class="mt-4 text-center">
                                <a href="https://aistudio.google.com/app/apikey" target="_blank"
                                    class="text-xs text-gold hover:underline opacity-80">Get a Key</a>
                            </div>
                        </div>
                    </div>

                    <!-- SETUP_STYLE State -->
                    <div v-else-if="appState === 'SETUP_STYLE'" key="setup_style"
                        class="flex-1 flex items-center justify-center">
                        <div class="w-full max-w-md mx-auto p-8">

                            <!-- Progress Indicator -->
                            <div class="flex justify-between mb-8 px-2">
                                <div v-for="(q, index) in questions" :key="index"
                                    class="h-1 flex-1 mx-1 rounded-full transition-all duration-500"
                                    :class="index <= interviewStep ? 'bg-gold' : 'bg-white/10'">
                                </div>
                            </div>

                            <div class="text-center mb-8">
                                <p class="text-xs text-gold uppercase tracking-widest mb-2">{{ currentQuestion.label }}
                                </p>
                                <h2 class="text-2xl text-white font-cinzel mb-2">{{ currentQuestion.question }}</h2>
                                <p class="text-xs text-secondary">{{ currentQuestion.subtitle }}</p>
                            </div>

                            <form @submit.prevent="nextStep" :class="{ 'animate-shake': isShake }" class="space-y-6">

                                <div class="relative">
                                    <textarea v-model="styleForm[currentQuestion.model]"
                                        :placeholder="currentQuestion.placeholder" class="ghost-input h-40 resize-none"
                                        autofocus></textarea>
                                </div>

                                <div class="flex gap-4 pt-4">
                                    <button v-if="interviewStep > 0" type="button" @click="prevStep"
                                        class="status-btn w-1/3">
                                        Back
                                    </button>
                                    <button type="submit" class="status-btn primary flex-1">
                                        {{ interviewStep === questions.length - 1 ? 'Initialize Core' : 'Next' }}
                                    </button>
                                </div>

                            </form>
                        </div>
                    </div>

                    <!-- DASHBOARD State -->
                    <div v-else-if="appState === 'DASHBOARD'" key="dashboard" class="flex-1 dashboard-container">

                        <!-- Mobile Menu Button -->
                        <button @click="toggleSidebar" class="menu-btn" :class="{ 'hidden': isSidebarOpen }">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>

                        <!-- Sidebar Overlay (Mobile) -->
                        <div class="sidebar-overlay" :class="{ 'active': isSidebarOpen }" @click="toggleSidebar"></div>

                        <!-- Sidebar -->
                        <aside class="sidebar" :class="{ 'open': isSidebarOpen }">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-sm text-gold uppercase tracking-widest">History</h3>
                                <!-- Close Button (Mobile) -->
                                <button @click="toggleSidebar" class="md:hidden text-secondary hover:text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <div v-if="history.length === 0" class="text-xs text-secondary text-center py-8">
                                No history yet
                            </div>

                            <div v-else class="space-y-2">
                                <div v-for="(item, index) in history" :key="index" @click="loadHistoryItem(item)"
                                    class="history-item">
                                    <div class="flex items-center gap-2">
                                        <span v-if="item.topic.includes('(Humanized)')"
                                            class="text-gold text-xs">✨</span>
                                        <p class="text-sm text-white truncate flex-1">{{ item.topic }}</p>
                                    </div>
                                    <p class="text-xs text-secondary mt-1">{{ item.timestamp }}</p>
                                </div>
                            </div>
                        </aside>

                        <!-- Main Area -->
                        <div class="main-area">

                            <!-- Toggle -->
                            <div class="toggle-group">
                                <button @click="toggleHomeworkType('text')"
                                    :class="{ 'active': homeworkType === 'text' }" class="toggle-btn">
                                    Text Homework
                                </button>
                                <button @click="toggleHomeworkType('math')"
                                    :class="{ 'active': homeworkType === 'math' }" class="toggle-btn">
                                    Math Homework
                                </button>
                            </div>

                            <!-- Form -->
                            <form @submit.prevent="generateHomework" :class="{ 'animate-shake': isShake }"
                                class="space-y-6">

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label
                                            class="text-xs text-gold uppercase tracking-widest mb-2 block">Topic</label>
                                        <input v-model="homeworkForm.topic" type="text"
                                            :placeholder="homeworkType === 'text' ? 'e.g., The Roman Empire' : 'e.g., Quadratic Equations'"
                                            class="ghost-input">
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs text-gold uppercase tracking-widest mb-2 block">Subject</label>
                                        <input v-model="homeworkForm.subject" type="text"
                                            :placeholder="homeworkType === 'text' ? 'e.g., History' : 'e.g., Algebra'"
                                            class="ghost-input">
                                    </div>
                                </div>

                                <div>
                                    <label class="text-xs text-gold uppercase tracking-widest mb-2 block">Type of
                                        Task</label>
                                    <input v-model="homeworkForm.taskType" type="text"
                                        :placeholder="homeworkType === 'text' ? 'e.g., Essay, Report, Summary' : 'e.g., Solve, Prove, Explain'"
                                        class="ghost-input">
                                </div>

                                <div>
                                    <label class="text-xs text-gold uppercase tracking-widest mb-2 block">Additional
                                        Details</label>
                                    <textarea v-model="homeworkForm.details"
                                        :placeholder="homeworkType === 'text' ? 'Any specific requirements or context...' : 'Show step-by-step work...'"
                                        class="ghost-input h-24 resize-none"></textarea>
                                </div>

                                <!-- File Upload -->
                                <div>
                                    <label class="text-xs text-gold uppercase tracking-widest mb-2 block">Upload Context
                                        (Optional)</label>
                                    <div class="file-drop-zone" @click="$refs.fileInput.click()" @dragover.prevent
                                        @drop.prevent="handleFileUpload">
                                        <p class="text-sm text-secondary">Click or drag files here</p>
                                        <p class="text-xs text-secondary mt-1">Images, PDFs, and Texts</p>
                                    </div>
                                    <input ref="fileInput" type="file" @change="handleFileUpload" multiple
                                        accept="image/*,.pdf,.txt,.doc,.docx" class="hidden">

                                    <div v-if="homeworkForm.files.length > 0" class="file-list">
                                        <div v-for="(file, index) in homeworkForm.files" :key="index" class="file-item">
                                            <span class="text-sm text-white">{{ file.name }}</span>
                                            <span @click="removeFile(index)" class="file-item-remove">✕</span>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="status-btn primary w-full">
                                    Generate
                                </button>

                            </form>

                        </div>

                    </div>

                    <!-- GENERATING State -->
                    <div v-else-if="appState === 'GENERATING'" key="generating"
                        class="flex-1 flex flex-col items-center justify-center p-8">
                        <div class="text-center mb-8">
                            <div class="thinking-core mx-auto mb-6"></div>
                            <p class="text-secondary text-sm animate-pulse">{{ systemMessage }}</p>
                        </div>

                        <!-- Thought Stream -->
                        <div v-if="thoughtLog.length > 0" ref="thoughtLogContainer"
                            class="w-full max-w-2xl space-y-2 max-h-60 overflow-y-auto custom-scrollbar bg-black/20 p-4 rounded-lg border border-white/5">
                            <div v-for="(log, index) in thoughtLog" :key="index"
                                class="text-xs font-mono transition-all duration-500 leading-relaxed"
                                :class="log.isThought ? 'text-gold/60' : 'text-white/80'">
                                <span v-if="log.isThought" class="opacity-50 mr-2">>></span>
                                <span>{{ log.text }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- RESULT State -->
                    <div v-else-if="appState === 'RESULT'" key="result"
                        class="flex-1 flex flex-col relative overflow-hidden">

                        <!-- Result Header -->
                        <div class="flex justify-between items-center p-6 border-b border-white/5 bg-black/20">
                            <button @click="appState = 'DASHBOARD'"
                                class="text-secondary hover:text-white flex items-center gap-2 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                </svg>
                                <span class="text-xs uppercase tracking-widest">Back</span>
                            </button>
                            <div class="flex gap-2">
                                <button @click="copyToClipboard" class="status-btn text-xs py-2 px-4">
                                    {{ copyBtnText }}
                                </button>
                                <button @click="generateHomework" class="status-btn primary text-xs py-2 px-4">
                                    Regenerate
                                </button>
                            </div>
                        </div>

                        <!-- Result Content -->
                        <div class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                            <div class="prose prose-invert max-w-none">
                                <div v-if="homeworkType === 'math'"
                                    class="font-mono text-sm whitespace-pre-wrap text-gray-300">
                                    {{ generatedContent }}
                                </div>
                                <div v-else class="whitespace-pre-wrap text-gray-200 leading-relaxed font-inter">
                                    {{ generatedContent }}
                                </div>
                            </div>
                        </div>

                        <!-- Result Footer -->
                        <div class="p-6 border-t border-white/5 bg-black/20 flex justify-between items-center">
                            <a href="https://quillbot.com/ai-content-detector" target="_blank"
                                class="text-xs text-secondary hover:text-gold transition-colors">
                                Check in Quillbot ↗
                            </a>
                            <button @click="humanizeContent"
                                class="status-btn text-xs py-2 px-4 border border-gold/20 hover:border-gold/50 text-gold">
                                Make Undetectable ✨
                            </button>
                        </div>

                    </div>

                </transition>

            </main>

            <!-- Footer -->
            <footer class="p-4 text-center border-t border-white/5">
                <p class="text-white/20 text-[10px] uppercase tracking-widest">
                    v2.1 &bull; System Active
                </p>
            </footer>

        </div>

    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Prompts -->
    <script src="js/prompts.js"></script>

    <!-- App Logic -->
    <script src="js/app.js"></script>

</body>

</html>